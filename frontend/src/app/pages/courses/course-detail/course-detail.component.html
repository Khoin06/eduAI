<!-- LOADING -->
<div *ngIf="isLoading" class="text-center text-muted py-5">
  <div class="spinner-border text-primary"></div>
  <p class="mt-3">Đang tải dữ liệu khóa học...</p>
</div>

<!-- NỘI DUNG KHÓA HỌC -->
<div class="container py-5" *ngIf="!isLoading && course">
  <h1 class="fw-bold mb-2">{{ course.title }}</h1>
  <p class="lead text-muted">{{ course.description }}</p>

  <hr />

  <!-- DANH SÁCH BÀI HỌC -->
  <h4>Nội dung khóa học ({{ lessons.length }} bài)</h4>
  <ul class="list-group mt-3">
    <li
      *ngFor="let lesson of lessons; let i = index"
      class="list-group-item d-flex justify-content-between align-items-center"
    >
      <div>
        <i 
        *ngIf="passedMap[lesson.id]" 
        class="bi bi-check-circle-fill text-success me-2" 
        title="Hoàn thành"
      ></i>
        <strong>{{ i + 1 }}. {{ lesson.title }}</strong>
        <small class="text-muted d-block">{{ lesson.duration }} phút</small>
      </div>

      <!-- BUTTON -->
        <button
          class="btn btn-sm"
          [ngClass]="unlockedMap[lesson.id] ? 'btn-primary' : 'btn-outline-secondary disabled'"
          (click)="goToLesson(lesson, i)"
        >
          {{ unlockedMap[lesson.id] ? 'Xem' : 'Khoá' }}
        </button>
    </li>
  </ul>
<div *ngIf="course">
  <div class="course-progress-container mt-4">
    <h3>Tiến Độ Khóa Học</h3>
    <p>Đã hoàn thành: **{{ passedLessons }} / {{ totalLessons }}** bài học</p>
    
    <div class="progress" style="height: 20px;">
      <div 
        class="progress-bar bg-success" 
        role="progressbar" 
        [style.width.%]="courseProgress" 
        [attr.aria-valuenow]="courseProgress" 
        aria-valuemin="0" 
        aria-valuemax="100">
        {{ courseProgress }}%
      </div>
    </div>
  </div>

  <hr>

  </div>
  <a routerLink="/courses" class="btn btn-outline-secondary btn-sm mt-4">
    ← Quay lại
  </a>
</div>


  <!-- CHI TIẾT BÀI HỌC -->
  <div *ngIf="selectedLesson" class="card mt-4 shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">{{ selectedLesson.title }}</h5>
    </div>
    <div class="card-body">
 

      <!-- NỘI DUNG -->
      <div [innerHTML]="selectedLesson.content"></div>

      <!-- QUIZ -->
      <div
        *ngIf="selectedLesson.quiz"
        class="mt-4 p-3 border rounded bg-light shadow-sm"
      >
        <h6 class="text-success">Quiz kiểm tra</h6>
        <p><strong>{{ selectedLesson.quiz.question }}</strong></p>

        <div class="form-check" *ngFor="let opt of selectedLesson.quiz.options">
          <input
            class="form-check-input"
            type="radio"
            [name]="'q' + selectedLesson.id"
            [id]="'opt' + opt.id"
          />
          <label class="form-check-label" [for]="'opt' + opt.id">
            {{ opt.text }}
          </label>
        </div>

        <button class="btn btn-success btn-sm mt-3">Nộp bài</button>
      </div>
    </div>
  </div>

  <!-- THÔNG BÁO KHI CHƯA CHỌN BÀI -->
  <div *ngIf="!selectedLesson" class="text-center text-muted py-5">
    Chọn một bài học để xem nội dung
  </div>


<!-- KHI KHÔNG CÓ DỮ LIỆU -->
<div *ngIf="!isLoading && lessons.length === 0" class="text-center text-muted py-5">
  Không có bài học nào trong khóa học này.
</div>
