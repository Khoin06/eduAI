<!-- LOADING -->
<div *ngIf="isLoading" class="text-center py-5 text-muted">
  <div class="spinner-border text-primary"></div>
  <p>ƒêang t·∫£i b√†i h·ªçc...</p>
</div>

<!-- B√ÄI H·ªåC -->
<div class="container py-5" *ngIf="!isLoading && lesson">
  <h2 class="fw-bold mb-3">{{ lesson.title }}</h2>
  <hr />

  <div [innerHTML]="lesson.content" class="mb-4"></div>

  <!-- QUIZ T·ª™ DB -->
  <div *ngIf="quiz" class="mt-4 p-3 border rounded bg-light shadow-sm">
    <h5 class="text-success">Quiz ki·ªÉm tra</h5>
    <p><strong>{{ quiz.question }}</strong></p>

    <div *ngFor="let opt of quiz.options" class="form-check">
      <input class="form-check-input" type="radio" [name]="'quiz' + quiz.id" />
      <label class="form-check-label">{{ opt.text }}</label>
    </div>
  </div>

  <!-- PH·∫¶N AI -->
  <div class="ai-section mt-4 p-4 border rounded shadow-sm">
    <h3>ü§ñ Tr·ª£ gi·∫£ng AI</h3>
    
    <button (click)="openChatDialog()" class="btn btn-primary">üí¨ Hi·ªÉn th·ªã Chat AI</button>
    <button class="btn btn-outline-primary" (click)="loadAISection()" [disabled]="isGeneratingQuiz">
      {{ isGeneratingQuiz ? 'ƒêang t·∫°o Quiz...' : 'Hi·ªÉn th·ªã Quiz AI' }}
    </button>

    <div *ngIf="isGeneratingQuiz" class="alert alert-info mt-3">
      <div class="spinner-border spinner-border-sm text-primary"></div>
      AI ƒëang t·∫°o quiz...
    </div>

    <div *ngIf="quizError" class="alert alert-danger mt-3">
      ‚ö†Ô∏è {{ quizError }}
    </div>

    <!-- QUIZ AI -->
    <div *ngIf="showQuiz && aiData?.quiz" class="mt-3 p-3 border rounded bg-light">
      <h4>üß† B√†i Quiz AI</h4>

      <div *ngFor="let q of aiData.quiz; let i = index" class="mb-4">
        <p><strong>{{ i + 1 }}. {{ q.question }}</strong></p>

        <div *ngFor="let opt of q.options" class="form-check">
          <input
            type="radio"
            class="form-check-input"
            [name]="'question' + i"
            [value]="opt"
            (change)="selectAnswer(i, opt)"
            [disabled]="submitted"
          />
          <label class="form-check-label">
            {{ opt }}

            <span *ngIf="submitted && resultStatus[i] === 'correct' && opt.charAt(0) === q.answer" style="color: green">
              ‚úÖ
            </span>

            <span *ngIf="submitted && resultStatus[i] === 'wrong' && userAnswers[i] === opt.charAt(0)" style="color: red">
              ‚ùå
            </span>
          </label>
        </div>
      </div>

      <button *ngIf="!submitted" class="btn btn-success" (click)="submitQuiz()">N·ªôp b√†i</button>

      <div *ngIf="submitted" class="alert alert-info mt-3">
        üéØ K·∫øt qu·∫£: {{ score }}/{{ aiData.quiz.length }} ƒëi·ªÉm
      </div>
    </div>
  </div>

  <a routerLink="/dashboard" class="btn btn-outline-secondary btn-sm mt-4">
    ‚Üê Quay l·∫°i
  </a>
</div>
<div *ngIf="isLoading" class="text-center py-5 text-muted">
  <div class="spinner-border text-primary"></div>
  <p>ƒêang t·∫£i b√†i h·ªçc...</p>
</div>



