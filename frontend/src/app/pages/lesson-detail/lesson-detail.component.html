<div class="container py-5" *ngIf="!isLoading && lesson">
  <h2 class="fw-bold mb-3">{{ lesson.title }}</h2>
  <hr>

  <div class="lesson-content mb-5">
    <div [innerHTML]="lesson.content"></div>
  </div>

  <!-- Quiz c√≥ s·∫µn -->
  <div *ngIf="quiz" class="mt-4 p-3 border rounded bg-light">
    <h5 class="text-success">Quiz ki·ªÉm tra</h5>
    <p><strong>{{ quiz.question }}</strong></p>
    <div class="form-check" *ngFor="let opt of quiz.options">
      <input class="form-check-input" type="radio" [name]="'quiz' + quiz.id" [id]="'opt' + opt.id" />
      <label class="form-check-label" [for]="'opt' + opt.id">
        {{ opt.text }}
      </label>
    </div>
  </div>

  <!-- ‚ú® PH·∫¶N AI T·ª∞ ƒê·ªòNG SINH -->
 <!-- <div *ngIf="aiData" class="mt-5 p-4 border rounded bg-white shadow-sm"> -->
    <!-- <h4 class="text-primary">ü§ñ Tr·ª£ gi·∫£ng AI</h4> -->
  <!-- <div *ngIf="aiData.quiz" class="mt-3">
      <h5>B√†i Quiz AI t·∫°o</h5>
      <div *ngFor="let q of aiData.quiz" class="mb-4">
        <p><b>{{ q.question }}</b></p>
        <ul>
          <li *ngFor="let opt of q.options">{{ opt }}</li>
        </ul>
      </div>
    </div> -->

    <!-- <div *ngIf="aiData.suggestions" class="mt-3">
      <h5>G·ª£i √Ω h·ªèi AI:</h5>
      <div class="list-group">
        <button *ngFor="let s of aiData.suggestions" class="list-group-item list-group-item-action">
          üí¨ {{ s }}
        </button>
      </div>
    </div> -->
  <!-- </div> -->
  <div class="ai-section">
    <h3>ü§ñ Tr·ª£ gi·∫£ng AI</h3>

    <button (click)="openChatDialog()" class="btn btn-primary">üí¨ Hi·ªÉn th·ªã Chat AI</button>
<button (click)="loadAISection()" class="btn btn-outline-primary ms-2" [disabled]="isGeneratingQuiz">
  üß© {{ isGeneratingQuiz ? 'ƒêang t·∫°o Quiz...' : 'Hi·ªÉn th·ªã Quiz' }}
</button>

<!-- Khi ƒëang t·∫£i -->
<div *ngIf="isGeneratingQuiz" class="alert alert-info mt-3 d-flex align-items-center gap-2">
  <div class="spinner-border text-primary spinner-border-sm"></div>
  <span>ü§ñ AI ƒëang t·∫°o b√†i Quiz, vui l√≤ng ch·ªù trong gi√¢y l√°t...</span>
</div>

<!-- Khi l·ªói -->
<div *ngIf="quizError" class="alert alert-danger mt-3">
  ‚ö†Ô∏è {{ quizError }}
</div>


    <!-- Quiz AI -->
<!-- ================== QUIZ AI ================== -->
<div *ngIf="showQuiz && aiData?.quiz" class="mt-3 p-3 border rounded shadow-sm bg-light">
  <h4>üß† B√†i Quiz AI t·∫°o</h4>

  <div *ngFor="let q of aiData.quiz; let i = index" class="mb-4">
    <p><b>{{ i + 1 }}. {{ q.question }}</b></p>

    <!-- V√≤ng l·∫∑p hi·ªÉn th·ªã c√°c l·ª±a ch·ªçn -->
    <div *ngFor="let opt of q.options" class="form-check">
      <input
        class="form-check-input"
        type="radio"
        [name]="'question' + i"
        [value]="opt"
        (change)="selectAnswer(i, opt)"
        [disabled]="submitted"
      />
      <label class="form-check-label">
        {{ opt }}
        <!-- ƒê√°nh d·∫•u ƒë√∫ng/sai sau khi n·ªôp -->
        <span *ngIf="submitted && q.correct === opt" class="text-success ms-2">‚úî</span>
        <span *ngIf="submitted && userAnswers[i] === opt && q.correct !== opt" class="text-danger ms-2">‚úñ</span>
      </label>
    </div>
  </div>

  <div class="mt-3">
    <button *ngIf="!submitted" (click)="submitQuiz()" class="btn btn-success">‚úÖ N·ªôp b√†i</button>
    <div *ngIf="submitted" class="alert alert-info mt-3">
      üéØ <strong>K·∫øt qu·∫£:</strong> {{ score }}/{{ aiData.quiz.length }} ƒëi·ªÉm
    </div>
  </div>
</div>
<!-- ============================================ -->


  </div>
  <div class="mt-4">
    <a routerLink="/dashboard" class="btn btn-outline-secondary btn-sm">
      ‚Üê Quay l·∫°i kh√≥a h·ªçc
    </a>
  </div>
</div>

<div *ngIf="isLoading" class="text-center py-5 text-muted">
  <div class="spinner-border text-primary"></div>
  <p>ƒêang t·∫£i b√†i h·ªçc...</p>
</div>